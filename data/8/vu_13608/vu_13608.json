{
  "Author": "This document was written by James T Ellis.",
  "CAM_AttackerAccessRequired": "0",
  "CAM_EaseOfExploitation": "0",
  "CAM_Exploitation": "0",
  "CAM_Impact": "0",
  "CAM_InternetInfrastructure": "0",
  "CAM_Population": "0",
  "CAM_ScoreCurrent": 0,
  "CAM_ScoreCurrentWidelyKnown": 0,
  "CAM_ScoreCurrentWidelyKnownExploited": 0,
  "CAM_WidelyKnown": "0",
  "CERTAdvisory": "CA-1997-16",
  "CVEIDs": "",
  "CVSS_AccessComplexity": "",
  "CVSS_AccessVector": "",
  "CVSS_Authenication": "",
  "CVSS_AvailabilityImpact": "",
  "CVSS_BaseScore": "",
  "CVSS_BaseVector": "",
  "CVSS_CollateralDamagePotential": "",
  "CVSS_ConfidentialityImpact": "",
  "CVSS_EnvironmentalScore": "",
  "CVSS_EnvironmentalVector": "",
  "CVSS_Exploitability": "",
  "CVSS_IntegrityImpact": "",
  "CVSS_RemediationLevel": "",
  "CVSS_ReportConfidence": "",
  "CVSS_SecurityRequirementsAR": "",
  "CVSS_SecurityRequirementsCR": "",
  "CVSS_SecurityRequirementsIR": "",
  "CVSS_TargetDistribution": "",
  "CVSS_TemporalScore": "",
  "CVSS_TemporalVector": "",
  "DateCreated": "1998-05-21T11:46:51-04:00",
  "DateFirstPublished": "",
  "DateLastUpdated": "1999-02-14T15:13:00-05:00",
  "DatePublic": "",
  "Description": "The ftpd server installs two signal handlers as part of its startup\nprocedure: one to catch SIGPIPE for control/data port connection closes,\nand one to catch SIGURG for when out-of-band signaling is used with the\nABOR (abort file transfer) command. The SIGPIPE handler is:\n\nlostconn(int sig)\n{\nif (debug)\nsyslog(LOG_DEBUG, \"lost connection to %s [%s]\", remotehost, remoteaddr);\ndologout(-1);\n}\n\n...which causes the ftpd server to exit via dologout() whenever the\ncontrol or data connection is unexpectedly closed. The function\ndologout() is:\n\ndologout(int status)\n{\nif (logged_in) {\n(void) seteuid((uid_t) 0);\nlogwtmp(ttyline, \"\", \"\");\n}\nsyslog(LOG_INFO, \"FTP session closed\");\nif (xferlog)\nclose(xferlog);\nacl_remove();\n/* beware of flushing buffers after a SIGPIPE */\n_exit(status);\n}\n\n...which changes the effective uid to 0, adds a logout record to wtmp,\ncloses the xferlog log file, removes this instance of the server from\nthe PID file for his class, and exits.\nThe initial part of the SIGURG handler is:\n\nmyoob(int sig)\n{\nchar *cp;\n\n/* only process if transfer occurring */\nif (!transflag)\nreturn;\ncp = tmpline;\nif (getline(cp, 7, stdin) == NULL) {\nreply(221, \"You could at least say goodbye.\");\ndologout(0);\n}\nupper(cp);\nif (strcmp(cp, \"ABOR\\r\\n\") == 0) {\ntmpline[0] = '\\0';\nreply(426, \"Transfer aborted. Data connection closed.\");\nreply(226, \"Abort successful\");\nlongjmp(urgcatch, 1);\n}\n(...)\n\n...which does nothing if transflag is 0 - not currently doing a file\ntransfer, but if you are and an ABOR command was issued along with the\n\"urgent\" data that caused this signal, then the procedure does a longjmp()\nrestoring the \"urgcatch\" saved state, which ultimately returns back to the\nserver main command loop.\nNow, the Netscape Navigator software aborts a file transfer by BOTH\nclosing the data connection AND issuing an ABOR with out-of-band signaling.\nIn many instances, the ftpd server gets the SIGPIPE due to the closed data\nconnection and begins the dologout() procedure. While it is uid 0 and\nsometimes while it also has the pid file advisory lock (which occurs in\nthe acl_remove() procedure), the ftpd server will sometimes be interrupted\nby the SIGURG that is delivered as part of the ABOR command. Since\ntransflag is not 0 (a file transfer WAS occuring), the signal handler does\na longjmp which ultimately returns to the main command loop...and presto,\nyou are uid 0, and to make things even better, the xferlog log file is\nclosed so nothing you do is even logged.",
  "ID": "VU#13608",
  "IDNumber": "13608",
  "IPProtocol": "",
  "Impact": "A user can become uid 0",
  "Keywords": [
    "wu-ftpd",
    "setjmp/longjmp",
    "signal handler"
  ],
  "Overview": "",
  "References": [
    "AA-97.03",
    ".auscert.org.au/pub/auscert/advisory/AA-97.03.ftpd.signal.handling.vul",
    "ftp://ftp.auscert.org.au/pub/auscert/advisory/AA-97.03.ftpd.signal.handling.vul"
  ],
  "Resolution": "",
  "Revision": "1",
  "SystemsAffectedPreamble": "",
  "ThanksAndCredit": "",
  "Title": "wuftpd.signal.handling",
  "US-CERTTechnicalAlert": "",
  "VRDA_D1_DirectReport": "",
  "VRDA_D1_Impact": "",
  "VRDA_D1_Population": "",
  "VulnerabilityCount": 1,
  "Workarounds": "Patch provided in INFO#97.30"
}